!(function ($, window) {
    var factsheetPrimaryInputs = $(".factsheet-primary-inputs");
    var deadlineTemplate = $("#factsheet-deadline-template").html();
    var requirementTemplate = $("#factsheet-requirement-template").html();
    var requirementTemplateGre = $("#factsheet-requirement-gre-template").html();
    var deadlineFormCount = $("#factsheet_deadline_form_count").val();
    var requirementFormCount = $("#factsheet_requirement_form_count").val();
    var requirementFormCountGre = $("#factsheet_requirement_form_gre_count").val();
    var contactsCount = $("#factsheet_gscontacts_count").val();
    var contactTemplate = $("#factsheet-gscontacts-template").html();
    var facultyTemplate = $("#factsheet-faculty-template").html();
  
    factsheetPrimaryInputs.on("click", ".add-factsheet-deadlines-field", function (event) {
      var target = $(event.target);
      var compiledTemplate = _.template(deadlineTemplate);
      target.before(compiledTemplate({ form_count: deadlineFormCount }));
      deadlineFormCount++;
    });
  
    factsheetPrimaryInputs.on("click", ".remove-factsheet-deadlines-field", function (event) {
      $(event.target).parent(".factsheet-deadlines-field").remove();
    });
  
    factsheetPrimaryInputs.on("click", ".add-factsheet-requirements-field", function (event) {
      var target = $(event.target);
      var compiledTemplate = _.template(requirementTemplate);
      target.before(compiledTemplate({ form_count: requirementFormCount }));
      requirementFormCount++;
    });

    factsheetPrimaryInputs.on("click", ".add-factsheet-gscontacts-field", function (event) {
      var target = $(event.target);
      var compiledTemplate = _.template(contactTemplate);
      target.before(compiledTemplate({ form_count: contactsCount }));
      contactsCount++;
    });

    factsheetPrimaryInputs.on("click", ".remove-factsheet-gscontacts-field", function (event) {
      $(event.target).parent(".factsheet-gscontacts-field").remove();
    });


    factsheetPrimaryInputs.on("click", ".add-factsheet-requirements-gre-field", function (event) {
        var target = $(event.target);
        var compiledTemplate = _.template(requirementTemplateGre);
        target.before(compiledTemplate({ form_count: requirementFormCountGre }));
        requirementFormCountGre++;
      });
  
    factsheetPrimaryInputs.on("click", ".remove-factsheet-requirements-gre-field", function (event) {
        $(event.target).parent(".factsheet-requirements-gre-field").remove();
      });
    
      factsheetPrimaryInputs.on("click", ".remove-factsheet-requirements-field", function (event) {
      $(event.target).parent(".factsheet-requirements-field").remove();
    });
  
    $("#factsheet-contact").on("click", ".remove-factsheet-contact", function (event) {
      $(event.target).parent(".factsheet-contact").remove();
    });
  
    $("#factsheet-faculty").on("click", ".remove-factsheet-faculty", function (event) {
      $(event.target).parent(".factsheet-faculty").remove();
    });
  
    // $("#contact-entry").autocomplete({
    //   minLength: 2,
    //   source: function (request, response) {
    //     try {
    //       abortRequest();
    //     } catch (error) {}
    //     var request = $.get(
    //       window.gs_factsheet.contact_rest_url,
    //       { search: request.term },
    //       function (data) {
    //         if (data !== null) {
    //           var suggestions = [];
    //           var contactData = [];
    //           for (var i = 0; i < data.length; i++) {
    //             if (data[i] !== 0) {
    //               contactData[data[i].id] = data[i];
    //               suggestions.push({ label: data[i].name, value: data[i].id });
    //             }
    //           }
    //           response(suggestions);
    //         }
    //       }
    //     );
    //   },
    //   select: function (event, ui) {
    //     var compiledTemplate = _.template(contactTemplate);
    //     var contact = contactData[ui.item.value];
    //     $(".factsheet-contact-wrapper").append(
    //       compiledTemplate({
    //         contact_name: ui.item.label,
    //         contact_term_id: ui.item.value,
    //         contact_address_one: contact.meta.gs_contact_address_one,
    //         contact_address_two: contact.meta.gs_contact_address_two,
    //         contact_city: contact.meta.gs_contact_city,
    //         contact_state: contact.meta.gs_contact_state,
    //         contact_postal: contact.meta.gs_contact_postal,
    //         contact_phone: contact.meta.gs_contact_phone,
    //         contact_fax: contact.meta.gs_contact_fax,
    //         contact_email: contact.meta.gs_contact_email,
    //       })
    //     );
    //   },
    //   close: function () {
    //     $("#contact-entry").val("");
    //   },
    // });
  
    $("#faculty-entry").autocomplete({
      minLength: 2,
      source: function (request, response) {
        try {
          abortRequest();
        } catch (error) {}
        var request = $.get(
          window.gs_factsheet.faculty_rest_url,
          { search: request.term },
          function (data) {
            if (data !== null) {
              var suggestions = [];
              for (var i = 0; i < data.length; i++) {
                if (data[i] !== 0) {
                  suggestions.push({ label: data[i].name, value: data[i].id });
                }
              }
              response(suggestions);
            }
          }
        );
      },
      select: function (event, ui) {
        var compiledTemplate = _.template(facultyTemplate);
        $(".factsheet-faculty-wrapper").append(
          compiledTemplate({ faculty_name: ui.item.label, term_id: ui.item.value })
        );
      },
      close: function () {
        $("#faculty-entry").val("");
      },
    });
  })(jQuery, window);